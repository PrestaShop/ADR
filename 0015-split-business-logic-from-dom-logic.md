# 15. Split business logic from dom logic of JavaScript classes and components 

Date: 2021-09-16

## Status

In discussion

## Context

PrestaShop developers are working on JavaScript components by mixing some DOM handlers with some logics not linked to the DOM at all. 

For example: 
The new product page is calculating some prices depending on events and form changes, for this it takes some datas from the DOM and manipulate theses datas at the same time than updating the DOM.

It cause some issues: 

- We can't use unit tests, because it rely on the DOM generated by a template engine (Twig, smarty...), except if we create a virtual DOM with hard coded markup which is unmaintainable.
- It's really hard to review, because we use intern dependencies that you should be aware of to review properly. If concerns are splitted properly, it's easier to understand.

Benefits:

- JavaScript unit tests are possible.
- Better readability and it is easier to review.
- Helpers are reusable in the future with any front-end libraries.

## Decision

[Please, take a look at this proof of concept](https://github.com/PrestaShop/PrestaShop/pull/25909), some tax ratios ccalculations are split into an helper folder, using functional programming (because it's easier to understand the data flow: You have some datas going in, you have some datas going out, which is not the case of class programming in general because it's a more complexe paradigm). And I added an unit test example using the helper. This unit test was totally impossible to be written with the class method, without having a complexe virtual dom system.

Some propositions:
- Always use the same folder containing helpers, but we have to decide if the folder is global, or inside every pages/components.
- Use functional programming, because it's more performing and doesn't require an object logic.
- Every helper require an unit test to be written in order to accept a pull request.

## Consequences

We have to think about the logic of our JavaScript code while working on something and split it as proposed. We also need to write unit tests.
